<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Sign up</title>
    <link rel="stylesheet" href="../SignUp/Sign%20up.css">
    <link rel="icon" type="image/png" href="../Images/logo_ExploreSpots_sin_fondo.png">
</head>

<body>
<div class="whiteRectangle">
    <div class="center">
        <form id="mainForm" method="post">
            <div>
                <label for="firstName"></label><input type="text" id="firstName" name="firstName" placeholder="First name" required class="small_inputs">
                <label for="lastName"></label><input type="text" id="lastName" name="lastName" placeholder="Last name" class="small_inputs">
            </div>

            <div>
                <label for="email"></label><input type="email" id="email" name="email" placeholder="Email" required class="big_inputs">
            </div>

            <div>
                <label for="username"></label><input type="text" id="username" name="username" placeholder="Username" required class="big_inputs">
            </div>

            <div>
                <label for="password"></label><input type="password" id="password" name="password" placeholder="Password" required class="big_inputs">
            </div>

            <div>
                <label for="confirmPassword"></label><input type="password" id="confirmPassword" name="confirmPassword" placeholder="Confirm Password" required class="big_inputs">
            </div>
            <div id="passwordError"></div>

            <div class="checkbox-container">
                <input type="checkbox" id="agreeTerms" name="agreeTerms">
                <label class="checkbox-label" for="agreeTerms">I accept the <a href="">Terms of Use & Privacy Policy </a></label>
            </div>

            <div>
                <button class="SignUpButton" type="submit" id="SignUpButton">Sign Up</button>
            </div>

            <div class="AlreadyAcc">
                Already have an account? <a href="../Login_index/index.html"> Login here </a>
            </div>

        </form>

    </div>
</div>
<script src="../JavaScript/passwordValidation.js"></script>
<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-auth.js";
    import { getFirestore, collection, addDoc, query, where, updateDoc  } from "https://www.gstatic.com/firebasejs/10.9.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBbGLFzzUj5y8F927mW6JcrObKnF9bynAY",
        authDomain: "proyecto-ps-22ec6.firebaseapp.com",
        projectId: "proyecto-ps-22ec6",
        storageBucket: "proyecto-ps-22ec6.appspot.com",
        messagingSenderId: "611131563975",
        appId: "1:611131563975:web:f5663ec606ee9eecf003e2",
        measurementId: "G-BJ8S3HC2XC"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);

    const auth = getAuth(app);
    const db = getFirestore(app);


    let RegisterUser = evt => {
        evt.preventDefault();

        let email = document.getElementById('email');
        let password = document.getElementById('password');
        let firstname = document.getElementById('firstName');
        let lastname = document.getElementById('lastName');
        let username = document.getElementById('username');

        createUserWithEmailAndPassword(auth, email.value, password.value)
            .then((credentials) => {
                console.log(credentials);
                return addDoc(collection(db, "usuario"), {
                    administrador: false,
                    lista_misEventos: [],
                    lista_otrosEventos: [],
                    lista_siguiendo: [],
                    lista_guardados: [],
                    lista_seguidores: [],
                    lista_publicaciones: [],
                    lista_misIncidencias: [],
                    nombre: firstname.value,
                    apellido: lastname.value,
                    user_id: email.value,
                    usuario: username.value,
                    email: email.value,
                    photoPerfil: "2024-03-17T13_07_47_126Z_Screenshot 2024-01-15 at 12.05.03.png"
                }).then((docRef) => {
                    // Devolver el DocumentReference
                    return docRef;
                });
            })
            .then((docRef) => {
                // Después de agregar los datos del usuario, puedes realizar otras operaciones si es necesario
                console.log("Usuario agregado correctamente a Firestore");
                console.log("ID del documento:", docRef.id);
                // Si necesitas actualizar algún campo con la ID del documento, aquí puedes hacerlo
                return updateDoc(docRef, {
                    user_id: docRef.id
                });
            }) .then(() => {
            console.log("Campo 'user_id' actualizado con éxito.");
            alert("Usuario creado correctamente");
            document.getElementById('mainForm').submit();
            validatePassword();
            })
            .catch((error) => {
                alert("Error: " + error.message);
                console.error("Error al cambiar el campo en Firestore:", error);
            });
    }
    document.getElementById('SignUpButton').addEventListener('click',RegisterUser);

</script>


</body>
</html>
